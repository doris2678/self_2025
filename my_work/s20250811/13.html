<!DOCTYPE html>30
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æŠ•ç±ƒå¤§è³½</title>
  <!-- è¼‰å…¥bs5 css -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.7/css/bootstrap.min.css"
    integrity="sha512-fw7f+TcMjTb7bpbLJZlP8g2Y4XcCyFZW8uy8HsRZsH/SwbMw0plKHFHr99DN3l04VsYNwvzicUX/6qurvIxbxw=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />

  <style>
    body {
      background: #f0f2f5;
    }

    #ball {
      position: fixed;
      width: 50px;
      height: 50px;
      pointer-events: none;
      display: none;
      z-index: 1050;
      user-select: none;
    }

    #ranking {
      max-width: 400px;
      margin: 40px auto;
    }

    #ranking h4 {
      margin-bottom: 20px;
    }

    .score-time {
      font-weight: 700;
    }

    .btn-lg {
      min-width: 120px;
    }

    .main-card {
      max-width: 700px;
      margin: 40px auto 0;
      padding: 20px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 0 15px rgb(0 0 0 / 0.1);
    }
  </style>
</head>

<body>
  <div class="main-card shadow-sm">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h5>å€’æ•¸è¨ˆæ™‚</h5>
        <div id="time" class="display-2 text-info score-time">10</div>
      </div>
      <div class="text-center flex-grow-1">
        <h2>ğŸ€ æŠ•ç±ƒå¤§è³½ ğŸ€</h2>
      </div>
      <div class="text-end">
        <h5>æœ€é«˜åˆ†æ•¸</h5>
        <div id="maxScore" class="display-4 text-primary score-time">0</div>
      </div>
    </div>

    <div class="row align-items-center mb-4">
      <div class="col-3 text-center">
        <img id="img-left" src="./images/left.jpg" class="img-fluid rounded" alt="å·¦å´åœ–" />
      </div>
      <div class="col-6 text-center">
        <h5>ç›®å‰åˆ†æ•¸</h5>
        <div id="score" class="display-3 text-success score-time">0</div>
      </div>
      <div class="col-3 text-center">
        <img id="img-right" src="./images/right.jpg" class="img-fluid rounded" alt="å³å´åœ–" />
      </div>
    </div>

    <div class="d-flex justify-content-center gap-3 mb-3">
      <button id="startBtn" type="button" class="btn btn-primary btn-lg">
        é–‹å§‹
      </button>
      <button id="shotBtn" type="button" class="btn btn-success btn-lg d-none" disabled>
        æŠ•ç±ƒ
      </button>
      <button id="stopBtn" type="button" class="btn btn-danger btn-lg">
        åœæ­¢
      </button>
    </div>
  </div>

  <img id="ball" src="./images/Basketball.png" alt="basketball" />     

  <div id="ranking" class="text-center">
    <h4>æ’è¡Œæ¦œ (æœ€é«˜5å)</h4>
    <ul id="rankList" class="list-group"></ul>
  </div>

  <!-- è¼‰å…¥bs5 js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.7/js/bootstrap.min.js"
    integrity="sha512-zKeerWHHuP3ar7kX2WKBSENzb+GJytFSBL6HrR2nPSR1kOX1qjm+oHooQtbDpDBSITgyl7QXZApvDfDWvKjkUw=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <!-- è¼‰å…¥jquery -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
    integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script>    
  $(document).ready(function(){ 
    const startBtn = $("#startBtn");
    const shotBtn = $("#shotBtn");
    const stopBtn = $("#stopBtn");
    const scoreSpan = $("#score");
    const timeSpan = $("#time");
    const maxScoreSpan = $("#maxScore");
    const rankList = $("#rankList");
    const ball = $("#ball");
    const imgleft=$("#img-left");
    const imgright=$("#img-right");

    let score = 0;
    let startTime = 10;
    const bonusTime = 30;
    let maxScore = 0;

    let myInterval = null;

    let getMaxScore = Number(localStorage.getItem("maxScore"));
    if (getMaxScore) maxScore = getMaxScore;

    maxScoreSpan.html(maxScore);
    timeSpan.html(startTime);
    scoreSpan.html(score);

    shotBtn.prop("disabled", true);

    // è®€å–æ’è¡Œæ¦œ
    function loadRanking() {
      let ranking = JSON.parse(localStorage.getItem("ranking")) || [];
      let tmp = '';
      ranking.forEach((s) => {
        tmp += `<li class="list-group-item list-group-item-primary fw-bold">${s} åˆ†</li>`;
      });
      rankList.html(tmp);     
    }

    // æ›´æ–°æ’è¡Œæ¦œ
    function updateRanking(newScore) {
      if (newScore <= 0) return;
      let ranking = JSON.parse(localStorage.getItem("ranking")) || [];
      ranking.push(newScore);
      ranking.sort((a, b) => b - a);
      ranking = ranking.slice(0, 5);
      localStorage.setItem("ranking", JSON.stringify(ranking));
      loadRanking();
    }

    loadRanking();

    function showStartBtn() {
      startBtn.removeClass("d-none");
      shotBtn.addClass("d-none");
    }

    function showShotBtn() {
      startBtn.addClass("d-none");
      shotBtn.removeClass("d-none");
    }

    // æŠ•ç±ƒå‹•ç•«
    function shootAnimation() {      
      const btnRect = imgright.get(0).getBoundingClientRect();       

      ball.css({
        left:btnRect.left + btnRect.width / 2 - 25 + "px",
        top:btnRect.top + btnRect.height / 2 - 25 + "px",
        display:"block",
        transition:"transform 0.6s ease-in-out"
      });

      const targetX =window.innerWidth / 3 - 25;
      const targetY =window.innerHeight / 3;

      const deltaX = targetX - (btnRect.left + btnRect.width / 2 - 25);
      const deltaY = targetY - (btnRect.top + btnRect.height / 2 - 25);

      requestAnimationFrame(() => {
        ball.css("transform", `translate(${deltaX}px, ${deltaY}px) scale(0.5)`);
      });

      setTimeout(() => {
        ball.css({                
          display:"none",
          transition:"none",
          transform:"none"
        });
      }, 600);
    }

    startBtn.on("click", () => {
      showShotBtn();
      shotBtn.prop("disabled", false);
      score = 0;
      scoreSpan.html(score);
      startTime = 10;
      timeSpan.html(startTime);
      timeSpan.addClass("text-info display-2 score-time");

      myInterval = setInterval(() => {
        startTime--;
        timeSpan.html(startTime);

        if (startTime < bonusTime) {
          timeSpan.addClass("text-danger display-2 score-time");
        } else {
          timeSpan.addClass("text-info display-2 score-time");
        }

        if (startTime <= 0) {
          clearInterval(myInterval);
          shotBtn.prop("disabled",true);
          updateRanking(score);
          if (score > maxScore) {
            maxScore = score;
            localStorage.setItem("maxScore", maxScore);
            maxScoreSpan.html(maxScore);
            alert("ç ´ç´€éŒ„äº†ï¼");
          }
          showStartBtn();
        }
      }, 1000);
    });

    shotBtn.on("click", () => {
      if (startTime < 1) return;
      shootAnimation();

      if (startTime > bonusTime) {
        score += 2;
      } else {
        score += 3;
      }
      scoreSpan.html(score);

      if (score > maxScore) {
        maxScore = score;
        localStorage.setItem("maxScore", maxScore);
        maxScoreSpan.html(maxScore);
      }
    });

    stopBtn.on("click", () => {
      clearInterval(myInterval);
      updateRanking(score);
      score = 0;
      scoreSpan.html(score);
      startTime = 10;
      timeSpan.html(startTime);
      timeSpan.addClass("text-info display-2 score-time");

      shotBtn.disabled = true;
      shotBtn.prop("disabled",true);
      showStartBtn();
    });

})  
  </script>
</body>

</html>